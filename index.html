<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MinecraftæœåŠ¡å™¨IPæ£€æµ‹ä¸åˆ†äº«å·¥å…·</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', 'Minecraft', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #3c8d2c 0%, #1e5a3c 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
            color: #333;
        }
        
        .container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
            padding: 40px;
            width: 100%;
            max-width: 750px;
            backdrop-filter: blur(10px);
            border: 8px solid #5a7d3a;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        h1 {
            color: #3c8d2c;
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
            font-family: 'Minecraft', monospace;
        }
        
        .subtitle {
            color: #666;
            font-size: 1.1rem;
            margin-bottom: 20px;
        }
        
        .minecraft-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }
        
        .server-info-card {
            background: #f0f7e6;
            border-radius: 15px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            border: 3px solid #5a7d3a;
        }
        
        .info-group {
            margin-bottom: 25px;
        }
        
        .info-group:last-child {
            margin-bottom: 0;
        }
        
        .info-title {
            font-weight: 600;
            color: #3c8d2c;
            font-size: 1.1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .info-title i {
            font-size: 1.2rem;
        }
        
        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        input {
            padding: 12px 16px;
            border: 2px solid #ccc;
            border-radius: 10px;
            font-size: 1rem;
            flex: 1;
            transition: all 0.3s;
        }
        
        input:focus {
            outline: none;
            border-color: #3c8d2c;
            box-shadow: 0 0 0 3px rgba(60, 141, 44, 0.2);
        }
        
        .port-input {
            width: 100px;
        }
        
        .connection-string {
            background: #fff;
            border: 2px dashed #5a7d3a;
            border-radius: 10px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 1.1rem;
            word-break: break-all;
            margin-top: 10px;
            color: #2d501c;
            background-color: #f9ffe6;
        }
        
        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin: 30px 0;
        }
        
        button {
            padding: 14px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
            min-width: 160px;
        }
        
        .primary-btn {
            background: linear-gradient(45deg, #3c8d2c, #2a6b1e);
            color: white;
        }
        
        .primary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(60, 141, 44, 0.4);
        }
        
        .secondary-btn {
            background: linear-gradient(45deg, #4a90e2, #2c6fb4);
            color: white;
        }
        
        .secondary-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(74, 144, 226, 0.4);
        }
        
        .success-btn {
            background: linear-gradient(45deg, #4CAF50, #2E7D32);
            color: white;
        }
        
        .success-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 20px rgba(76, 175, 80, 0.4);
        }
        
        .share-section {
            background: #e8f5e9;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid #a5d6a7;
        }
        
        .share-options {
            display: flex;
            gap: 15px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .share-btn {
            padding: 12px 20px;
            border-radius: 8px;
            background: #fff;
            border: 2px solid #3c8d2c;
            color: #3c8d2c;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            min-width: 120px;
            justify-content: center;
        }
        
        .share-btn:hover {
            background: #3c8d2c;
            color: white;
        }
        
        .qr-code-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border-radius: 10px;
            border: 2px solid #ddd;
        }
        
        #qrcode {
            width: 200px;
            height: 200px;
            margin: 15px 0;
        }
        
        .instructions {
            background: #fff9e6;
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid #ffd54f;
        }
        
        .instructions h3 {
            color: #f57c00;
            margin-bottom: 15px;
            font-size: 1.2rem;
        }
        
        .instructions ol {
            padding-left: 20px;
            margin-bottom: 15px;
        }
        
        .instructions li {
            margin-bottom: 10px;
            line-height: 1.6;
        }
        
        .status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 20px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 10px;
            font-size: 0.95rem;
            color: #666;
        }
        
        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ccc;
            margin-right: 8px;
        }
        
        .status-dot.active {
            background: #4CAF50;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .validation-issues {
            background: #ffebee;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            border-left: 4px solid #f44336;
            display: none;
        }
        
        .validation-issues.show {
            display: block;
        }
        
        .validation-issues h4 {
            color: #d32f2f;
            margin-bottom: 8px;
            font-size: 1rem;
        }
        
        .validation-issues ul {
            padding-left: 20px;
            margin: 0;
        }
        
        .validation-issues li {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }
        
        .ip-examples {
            background: #e3f2fd;
            border-radius: 10px;
            padding: 12px 16px;
            margin: 10px 0;
            border-left: 4px solid #2196f3;
            font-size: 0.9rem;
        }
        
        .ip-examples strong {
            color: #1565c0;
        }
        
        .ip-examples span {
            font-family: 'Courier New', monospace;
            background: #fff;
            padding: 2px 6px;
            border-radius: 4px;
            margin: 0 4px;
        }
        
        footer {
            text-align: center;
            margin-top: 30px;
            color: #666;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .note {
            background: #e3f2fd;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 25px 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .controls, .share-options {
                flex-direction: column;
            }
            
            button, .share-btn {
                width: 100%;
            }
            
            .input-group {
                flex-direction: column;
            }
            
            .port-input {
                width: 100%;
            }
            
            #qrcode {
                width: 150px;
                height: 150px;
            }
        }
        
        .copied-notice {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
            display: none;
            z-index: 1000;
        }
        
        .minecraft-block {
            display: inline-block;
            width: 20px;
            height: 20px;
            background: #3c8d2c;
            margin: 0 5px;
            vertical-align: middle;
        }
        
        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
            margin-left: 5px;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 300px;
            background-color: #333;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
            font-weight: normal;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        .validation-ok {
            background: #e8f5e9;
            border-left: 4px solid #4CAF50;
        }
        
        .validation-ok h4 {
            color: #2E7D32;
        }
    </style>
    <!-- QR Code ç”Ÿæˆåº“ -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.0/build/qrcode.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="minecraft-icon">â›ï¸ğŸ§±ğŸŒ³</div>
            <h1>Minecraft æœåŠ¡å™¨IPå·¥å…·</h1>
            <p class="subtitle">è½»æ¾è·å–ã€ç”Ÿæˆå’Œåˆ†äº«æ‚¨çš„MinecraftæœåŠ¡å™¨è¿æ¥ä¿¡æ¯</p>
        </header>
        
        <div class="ip-examples">
            <strong>æ”¯æŒçš„IPåœ°å€æ ¼å¼ç¤ºä¾‹ï¼š</strong>
            <span>192.168.1.1</span>
            <span>play.example.com</span>
            <span>mc.server.com:25566</span>
            <span>123.45.67.89:25565</span>
        </div>
        
        <div class="server-info-card">
            <div class="info-group">
                <div class="info-title">
                    <span>ğŸ–¥ï¸ æœåŠ¡å™¨è¿æ¥ä¿¡æ¯</span>
                </div>
                
                <div class="input-group">
                    <input type="text" id="server-ip" placeholder="è¾“å…¥æœåŠ¡å™¨IPåœ°å€ (ä¾‹å¦‚: 123.45.67.89 æˆ– play.example.com)">
                    <input type="text" id="server-port" class="port-input" placeholder="ç«¯å£" value="25565">
                </div>
                
                <div id="validation-issues" class="validation-issues">
                    <h4>âš ï¸ éªŒè¯é—®é¢˜ï¼š</h4>
                    <ul id="issue-list"></ul>
                </div>
                
                <div id="validation-ok" class="validation-issues validation-ok" style="display: none;">
                    <h4>âœ“ IPåœ°å€éªŒè¯é€šè¿‡</h4>
                    <p>è¿æ¥ä¿¡æ¯å·²å‡†å¤‡å°±ç»ª</p>
                </div>
                
                <div class="info-title">
                    <span>ğŸ”— Minecraftè¿æ¥å­—ç¬¦ä¸²</span>
                    <div class="tooltip">?
                        <span class="tooltiptext">å°†æ­¤è¿æ¥å­—ç¬¦ä¸²å¤åˆ¶åˆ°Minecraftæ¸¸æˆçš„"æœåŠ¡å™¨åœ°å€"ä¸­ï¼Œæˆ–ç›´æ¥å‘é€ç»™æœ‹å‹</span>
                    </div>
                </div>
                <div id="connection-string" class="connection-string">
                    <span id="connection-text">è¯·å…ˆè¾“å…¥æœåŠ¡å™¨IPåœ°å€</span>
                </div>
            </div>
            
            <div class="info-group">
                <div class="info-title">
                    <span>ğŸŒ æ‚¨çš„å…¬ç½‘IPåœ°å€</span>
                </div>
                <div id="public-ip" class="connection-string">
                    æ­£åœ¨æ£€æµ‹æ‚¨çš„å…¬ç½‘IPåœ°å€...
                </div>
            </div>
        </div>
        
        <div class="controls">
            <button id="get-ip-btn" class="primary-btn">
                <span>ğŸŒ</span> è·å–æˆ‘çš„å…¬ç½‘IP
            </button>
            <button id="generate-btn" class="secondary-btn">
                <span>âš¡</span> ç”Ÿæˆè¿æ¥ä¿¡æ¯
            </button>
            <button id="copy-btn" class="success-btn">
                <span>ğŸ“‹</span> å¤åˆ¶è¿æ¥ä¿¡æ¯
            </button>
        </div>
        
        <div class="share-section">
            <div class="info-title">
                <span>ğŸ“¤ åˆ†äº«ç»™æœ‹å‹</span>
            </div>
            <p>é€šè¿‡ä»¥ä¸‹æ–¹å¼åˆ†äº«æ‚¨çš„MinecraftæœåŠ¡å™¨ä¿¡æ¯ï¼š</p>
            
            <div class="share-options">
                <button id="share-text-btn" class="share-btn">
                    <span>ğŸ“</span> ç”Ÿæˆåˆ†äº«æ–‡æœ¬
                </button>
                <button id="share-qr-btn" class="share-btn">
                    <span>ğŸ“±</span> ç”ŸæˆQRç 
                </button>
            </div>
            
            <div id="qr-code-container" class="qr-code-container" style="display: none;">
                <p>ä½¿ç”¨æ‰‹æœºæ‰«ææ­¤QRç è¿æ¥æœåŠ¡å™¨ï¼š</p>
                <div id="qrcode"></div>
                <p>æˆ–å‘é€æ­¤é“¾æ¥ç»™æœ‹å‹ï¼š<br><span id="qr-link" style="font-size: 0.9rem; color: #3c8d2c; word-break: break-all;"></span></p>
            </div>
        </div>
        
        <div class="instructions">
            <h3>ğŸ“‹ MinecraftæœåŠ¡å™¨è¿æ¥æŒ‡å—</h3>
            <ol>
                <li><strong>è¾“å…¥æœåŠ¡å™¨IP</strong>: åœ¨ä¸Šæ–¹è¾“å…¥æ‚¨çš„MinecraftæœåŠ¡å™¨IPåœ°å€å’Œç«¯å£ï¼ˆé»˜è®¤25565ï¼‰</li>
                <li><strong>ç”Ÿæˆè¿æ¥ä¿¡æ¯</strong>: ç‚¹å‡»"ç”Ÿæˆè¿æ¥ä¿¡æ¯"æŒ‰é’®åˆ›å»ºè¿æ¥å­—ç¬¦ä¸²</li>
                <li><strong>å¤åˆ¶è¿æ¥ä¿¡æ¯</strong>: ç‚¹å‡»"å¤åˆ¶è¿æ¥ä¿¡æ¯"æŒ‰é’®å¤åˆ¶åˆ°å‰ªè´´æ¿</li>
                <li><strong>åœ¨Minecraftä¸­è¿æ¥</strong>:
                    <ul style="margin-top: 8px; margin-left: 20px;">
                        <li>æ‰“å¼€Minecraftæ¸¸æˆ</li>
                        <li>ç‚¹å‡»"å¤šäººæ¸¸æˆ" â†’ "æ·»åŠ æœåŠ¡å™¨"</li>
                        <li>åœ¨"æœåŠ¡å™¨åœ°å€"ä¸­ç²˜è´´å¤åˆ¶çš„è¿æ¥ä¿¡æ¯</li>
                        <li>ç‚¹å‡»"å®Œæˆ"ç„¶ååŠ å…¥æœåŠ¡å™¨</li>
                    </ul>
                </li>
            </ol>
            <div class="note">
                <strong>æ³¨æ„:</strong> è¦ä½¿æœ‹å‹èƒ½å¤Ÿè¿æ¥åˆ°æ‚¨çš„æœåŠ¡å™¨ï¼Œæ‚¨éœ€è¦ç¡®ä¿:
                1. æ‚¨çš„ç½‘ç»œè·¯ç”±å™¨å·²æ­£ç¡®è®¾ç½®ç«¯å£è½¬å‘ï¼ˆé»˜è®¤ç«¯å£: 25565ï¼‰
                2. é˜²ç«å¢™å…è®¸MinecraftæœåŠ¡å™¨é€šè¿‡
                3. æ‚¨ä½¿ç”¨çš„æ˜¯å…¬ç½‘IPåœ°å€ï¼Œè€Œéå±€åŸŸç½‘IPï¼ˆå¦‚192.168.x.xï¼‰
            </div>
        </div>
        
        <div class="status">
            <div>
                <span>çŠ¶æ€:</span>
                <span id="status-text">å°±ç»ª</span>
            </div>
            <div>
                <span class="status-dot"></span>
                <span id="last-updated">--</span>
            </div>
        </div>
        
        <footer>
            <p>â›ï¸ MinecraftæœåŠ¡å™¨IPå·¥å…· v1.1 | æ”¹è¿›çš„IPéªŒè¯é€»è¾‘</p>
            <p>ç¡®ä¿æ‚¨æ‹¥æœ‰è¿è¡ŒMinecraftæœåŠ¡å™¨çš„åˆæ³•æƒé™ï¼Œå¹¶éµå®ˆMinecraftæœ€ç»ˆç”¨æˆ·è®¸å¯åè®®</p>
        </footer>
    </div>

    <div id="copied-notice" class="copied-notice">
        å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼
    </div>

    <script>
        // DOMå…ƒç´ 
        const serverIpInput = document.getElementById('server-ip');
        const serverPortInput = document.getElementById('server-port');
        const connectionText = document.getElementById('connection-text');
        const publicIpElement = document.getElementById('public-ip');
        const getIpBtn = document.getElementById('get-ip-btn');
        const generateBtn = document.getElementById('generate-btn');
        const copyBtn = document.getElementById('copy-btn');
        const shareTextBtn = document.getElementById('share-text-btn');
        const shareQrBtn = document.getElementById('share-qr-btn');
        const qrCodeContainer = document.getElementById('qr-code-container');
        const qrLinkElement = document.getElementById('qr-link');
        const statusText = document.getElementById('status-text');
        const lastUpdatedElement = document.getElementById('last-updated');
        const copiedNotice = document.getElementById('copied-notice');
        const validationIssues = document.getElementById('validation-issues');
        const validationOk = document.getElementById('validation-ok');
        const issueList = document.getElementById('issue-list');
        
        // çŠ¶æ€å˜é‡
        let publicIp = '';
        let serverConnectionString = '';
        let validationTimeout = null;
        
        // IPæŸ¥è¯¢APIåˆ—è¡¨
        const ipApis = [
            'https://api.ipify.org?format=json',
            'https://api64.ipify.org?format=json',
            'https://api.my-ip.io/ip.json',
            'https://ipapi.co/json/'
        ];
        
        // æ›´æ–°çŠ¶æ€
        function updateStatus(message, type = 'info') {
            statusText.textContent = message;
            statusText.style.color = type === 'error' ? '#f44336' : 
                                   type === 'success' ? '#4CAF50' : '#666';
            
            const now = new Date();
            const timeString = now.toLocaleTimeString('zh-CN', { 
                hour12: false,
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
            lastUpdatedElement.textContent = `æœ€åæ›´æ–°: ${timeString}`;
        }
        
        // æ˜¾ç¤ºæç¤ºæ¶ˆæ¯
        function showNotice(message, duration = 2000) {
            copiedNotice.textContent = message;
            copiedNotice.style.display = 'block';
            copiedNotice.style.background = '#4CAF50';
            
            setTimeout(() => {
                copiedNotice.style.display = 'none';
            }, duration);
        }
        
        // æ˜¾ç¤ºé”™è¯¯æ¶ˆæ¯
        function showError(message) {
            copiedNotice.textContent = message;
            copiedNotice.style.display = 'block';
            copiedNotice.style.background = '#f44336';
            
            setTimeout(() => {
                copiedNotice.style.display = 'none';
            }, 3000);
        }
        
        // æ˜¾ç¤ºéªŒè¯é—®é¢˜
        function showValidationIssues(issues) {
            if (issues && issues.length > 0) {
                issueList.innerHTML = '';
                issues.forEach(issue => {
                    const li = document.createElement('li');
                    li.textContent = issue;
                    issueList.appendChild(li);
                });
                validationIssues.classList.add('show');
                validationOk.style.display = 'none';
            } else {
                validationIssues.classList.remove('show');
                validationOk.style.display = 'block';
            }
        }
        
        // è·å–å…¬ç½‘IP
        async function getPublicIp() {
            getIpBtn.disabled = true;
            getIpBtn.innerHTML = '<span>â³</span> è·å–ä¸­...';
            updateStatus('æ­£åœ¨è·å–å…¬ç½‘IPåœ°å€...');
            
            // å°è¯•å¤šä¸ªIPæŸ¥è¯¢API
            for (let i = 0; i < ipApis.length; i++) {
                try {
                    const response = await fetch(ipApis[i], { 
                        method: 'GET',
                        mode: 'cors',
                        headers: { 'Accept': 'application/json' }
                    });
                    
                    if (!response.ok) continue;
                    
                    const data = await response.json();
                    
                    // ä¸åŒAPIè¿”å›æ ¼å¼ä¸åŒ
                    if (ipApis[i].includes('ipify.org')) {
                        publicIp = data.ip;
                    } else if (ipApis[i].includes('my-ip.io')) {
                        publicIp = data.ip;
                    } else if (ipApis[i].includes('ipapi.co')) {
                        publicIp = data.ip;
                    }
                    
                    if (publicIp) {
                        publicIpElement.textContent = publicIp;
                        updateStatus('å…¬ç½‘IPè·å–æˆåŠŸ', 'success');
                        serverIpInput.value = publicIp;
                        validateAndGenerateConnectionString();
                        break;
                    }
                } catch (error) {
                    // ç»§ç»­å°è¯•ä¸‹ä¸€ä¸ªAPI
                }
            }
            
            if (!publicIp) {
                publicIpElement.textContent = 'è·å–å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è¾“å…¥IPåœ°å€';
                updateStatus('æ— æ³•è·å–å…¬ç½‘IPï¼Œè¯·æ‰‹åŠ¨è¾“å…¥', 'error');
            }
            
            getIpBtn.disabled = false;
            getIpBtn.innerHTML = '<span>ğŸŒ</span> è·å–æˆ‘çš„å…¬ç½‘IP';
        }
        
        // æ”¹è¿›çš„åœ°å€éªŒè¯å‡½æ•°
        function isValidAddress(address) {
            const issues = [];
            
            if (!address || address.trim() === '') {
                issues.push('IPåœ°å€ä¸èƒ½ä¸ºç©º');
                return { valid: false, issues, cleanedAddress: '' };
            }
            
            const cleanedAddress = address.trim();
            
            // æ£€æŸ¥æ˜¯å¦åŒ…å«ç«¯å£
            let ipPart = cleanedAddress;
            let portPart = '';
            
            if (cleanedAddress.includes(':')) {
                const parts = cleanedAddress.split(':');
                if (parts.length === 2) {
                    ipPart = parts[0];
                    portPart = parts[1];
                    
                    // éªŒè¯ç«¯å£
                    const portNum = parseInt(portPart, 10);
                    if (isNaN(portNum) || portNum < 1 || portNum > 65535) {
                        issues.push(`ç«¯å£ "${portPart}" æ— æ•ˆï¼Œè¯·ä½¿ç”¨1-65535ä¹‹é—´çš„æ•°å­—`);
                        ipPart = cleanedAddress; // æ¢å¤åŸå§‹åœ°å€
                    }
                } else if (parts.length > 2) {
                    // å¯èƒ½æ˜¯IPv6åœ°å€ï¼Œæš‚æ—¶æ¥å—
                }
            }
            
            // éªŒè¯IPéƒ¨åˆ†
            // 1. æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„IPv4åœ°å€
            const ipv4Regex = /^(\d{1,3})\.(\d{1,3})\.(\d{1,3})\.(\d{1,3})$/;
            const ipv4Match = ipPart.match(ipv4Regex);
            
            if (ipv4Match) {
                // æ£€æŸ¥æ¯ä¸ªéƒ¨åˆ†æ˜¯å¦åœ¨0-255ä¹‹é—´
                for (let i = 1; i <= 4; i++) {
                    const num = parseInt(ipv4Match[i], 10);
                    if (num < 0 || num > 255) {
                        issues.push(`IPv4åœ°å€æ®µ "${num}" è¶…å‡ºèŒƒå›´ (0-255)`);
                        return { valid: false, issues, cleanedAddress: ipPart };
                    }
                }
                
                // æ£€æŸ¥ç‰¹æ®ŠIPåœ°å€
                if (ipPart.startsWith('0.')) {
                    issues.push('è­¦å‘Š: ä»¥0å¼€å¤´çš„IPåœ°å€å¯èƒ½æ— æ³•æ­£å¸¸ä½¿ç”¨');
                } else if (ipPart.startsWith('127.')) {
                    issues.push('è­¦å‘Š: 127.x.x.xæ˜¯å›ç¯åœ°å€ï¼Œåªèƒ½æœ¬åœ°è®¿é—®');
                } else if (ipPart.startsWith('169.254.')) {
                    issues.push('è­¦å‘Š: 169.254.x.xæ˜¯APIPAåœ°å€ï¼Œé€šå¸¸è¡¨ç¤ºç½‘ç»œé…ç½®é—®é¢˜');
                } else if (ipPart.startsWith('192.168.') || 
                          ipPart.startsWith('10.') || 
                          (ipPart.startsWith('172.') && parseInt(ipPart.split('.')[1], 10) >= 16 && parseInt(ipPart.split('.')[1], 10) <= 31)) {
                    issues.push('æ³¨æ„: è¿™æ˜¯ç§æœ‰IPåœ°å€ï¼Œæœ‹å‹éœ€è¦è¿æ¥åˆ°æ‚¨çš„å…¬ç½‘IPæ‰èƒ½è®¿é—®');
                }
                
                return { valid: true, issues, cleanedAddress: ipPart };
            }
            
            // 2. æ£€æŸ¥æ˜¯å¦ä¸ºæœ‰æ•ˆçš„åŸŸå
            const domainRegex = /^(?!:\/\/)([a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?\.)+[a-zA-Z]{2,}$/;
            if (domainRegex.test(ipPart)) {
                return { valid: true, issues, cleanedAddress: ipPart };
            }
            
            // 3. æ£€æŸ¥æ˜¯å¦ä¸ºlocalhost
            if (ipPart.toLowerCase() === 'localhost') {
                issues.push('æ³¨æ„: localhoståªèƒ½æœ¬åœ°è®¿é—®ï¼Œæœ‹å‹æ— æ³•è¿æ¥');
                return { valid: true, issues, cleanedAddress: ipPart };
            }
            
            // 4. ç®€å•çš„IPv6æ£€æŸ¥ï¼ˆç®€åŒ–ç‰ˆï¼‰
            const ipv6Regex = /^([0-9a-fA-F]{1,4}:){7}[0-9a-fA-F]{1,4}$|^::([0-9a-fA-F]{1,4}:){0,6}[0-9a-fA-F]{1,4}$|^([0-9a-fA-F]{1,4}:){1,7}:$/;
            if (ipv6Regex.test(ipPart)) {
                return { valid: true, issues, cleanedAddress: ipPart };
            }
            
            // 5. å¦‚æœä»¥ä¸Šéƒ½ä¸åŒ¹é…ï¼Œä½†çœ‹èµ·æ¥åƒIPåœ°å€
            if (/^[0-9\.:a-fA-F-]+$/.test(ipPart)) {
                issues.push('è­¦å‘Š: æ— æ³•è¯†åˆ«çš„IPåœ°å€æ ¼å¼ï¼Œä½†å¯èƒ½æœ‰æ•ˆ');
                return { valid: true, issues, cleanedAddress: ipPart };
            }
            
            issues.push('IPåœ°å€æ ¼å¼æ— æ•ˆï¼Œè¯·è¾“å…¥æœ‰æ•ˆçš„IPåœ°å€æˆ–åŸŸå');
            return { valid: false, issues, cleanedAddress: ipPart };
        }
        
        // éªŒè¯å¹¶ç”Ÿæˆè¿æ¥å­—ç¬¦ä¸²
        function validateAndGenerateConnectionString() {
            let ip = serverIpInput.value.trim();
            let port = serverPortInput.value.trim();
            
            if (!ip) {
                connectionText.textContent = 'è¯·å…ˆè¾“å…¥æœåŠ¡å™¨IPåœ°å€';
                showValidationIssues(['è¯·è¾“å…¥æœåŠ¡å™¨IPåœ°å€']);
                updateStatus('è¯·è¾“å…¥æœåŠ¡å™¨IPåœ°å€', 'error');
                return;
            }
            
            // éªŒè¯IPåœ°å€
            const validation = isValidAddress(ip);
            
            if (!validation.valid) {
                connectionText.textContent = 'IPåœ°å€æ ¼å¼æ— æ•ˆ';
                showValidationIssues(validation.issues);
                updateStatus('IPåœ°å€æ ¼å¼æ— æ•ˆ', 'error');
                return;
            }
            
            // æ˜¾ç¤ºéªŒè¯é—®é¢˜ï¼ˆå³ä½¿æ˜¯è­¦å‘Šï¼‰
            showValidationIssues(validation.issues);
            
            // å¦‚æœæ²¡æœ‰ç«¯å£ï¼Œä½¿ç”¨é»˜è®¤ç«¯å£
            if (!port) {
                port = '25565';
                serverPortInput.value = '25565';
            }
            
            // éªŒè¯ç«¯å£
            const portNum = parseInt(port, 10);
            if (isNaN(portNum) || portNum < 1 || portNum > 65535) {
                showValidationIssues([`ç«¯å£ "${port}" æ— æ•ˆï¼Œè¯·ä½¿ç”¨1-65535ä¹‹é—´çš„æ•°å­—`]);
                updateStatus('ç«¯å£æ— æ•ˆ', 'error');
                return;
            }
            
            // ç”Ÿæˆè¿æ¥å­—ç¬¦ä¸²
            if (port === '25565') {
                serverConnectionString = validation.cleanedAddress; // é»˜è®¤ç«¯å£å¯ä»¥çœç•¥
            } else {
                serverConnectionString = `${validation.cleanedAddress}:${port}`;
            }
            
            connectionText.textContent = serverConnectionString;
            updateStatus('è¿æ¥ä¿¡æ¯å·²ç”Ÿæˆ', 'success');
        }
        
        // å¤åˆ¶è¿æ¥ä¿¡æ¯åˆ°å‰ªè´´æ¿
        function copyConnectionString() {
            if (!serverConnectionString) {
                showError('è¯·å…ˆç”Ÿæˆè¿æ¥ä¿¡æ¯');
                return;
            }
            
            navigator.clipboard.writeText(serverConnectionString)
                .then(() => {
                    showNotice('è¿æ¥ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    updateStatus('è¿æ¥ä¿¡æ¯å·²å¤åˆ¶', 'success');
                })
                .catch(err => {
                    // å¦‚æœclipboard APIä¸å¯ç”¨ï¼Œä½¿ç”¨å¤‡ç”¨æ–¹æ³•
                    const textArea = document.createElement('textarea');
                    textArea.value = serverConnectionString;
                    document.body.appendChild(textArea);
                    textArea.select();
                    
                    try {
                        const successful = document.execCommand('copy');
                        if (successful) {
                            showNotice('è¿æ¥ä¿¡æ¯å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                            updateStatus('è¿æ¥ä¿¡æ¯å·²å¤åˆ¶', 'success');
                        } else {
                            showError('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                        }
                    } catch (err) {
                        showError('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                    }
                    
                    document.body.removeChild(textArea);
                });
        }
        
        // ç”Ÿæˆåˆ†äº«æ–‡æœ¬
        function generateShareText() {
            if (!serverConnectionString) {
                showError('è¯·å…ˆç”Ÿæˆè¿æ¥ä¿¡æ¯');
                return;
            }
            
            const shareText = `ğŸ® MinecraftæœåŠ¡å™¨è¿æ¥ä¿¡æ¯ ğŸ®\n\næœåŠ¡å™¨åœ°å€: ${serverConnectionString}\n\nå¤åˆ¶æ­¤åœ°å€åˆ°Minecraftçš„"æœåŠ¡å™¨åœ°å€"ä¸­å³å¯åŠ å…¥ï¼\n\nç”Ÿæˆæ—¶é—´: ${new Date().toLocaleString('zh-CN')}`;
            
            navigator.clipboard.writeText(shareText)
                .then(() => {
                    showNotice('åˆ†äº«æ–‡æœ¬å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼');
                    updateStatus('åˆ†äº«æ–‡æœ¬å·²å¤åˆ¶', 'success');
                })
                .catch(err => {
                    showError('æ— æ³•å¤åˆ¶ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
                });
        }
        
        // ç”ŸæˆQRç 
        function generateQRCode() {
            if (!serverConnectionString) {
                showError('è¯·å…ˆç”Ÿæˆè¿æ¥ä¿¡æ¯');
                return;
            }
            
            // ç”Ÿæˆè¿æ¥URL
            const connectionUrl = `minecraft://?addExternalServer=${encodeURIComponent(serverConnectionString)}`;
            
            // æ˜¾ç¤ºQRç å®¹å™¨
            qrCodeContainer.style.display = 'flex';
            qrLinkElement.textContent = connectionUrl;
            
            // ç”ŸæˆQRç 
            document.getElementById('qrcode').innerHTML = '';
            QRCode.toCanvas(document.getElementById('qrcode'), connectionUrl, 
                { width: 200, height: 200, margin: 1 }, 
                function(error) {
                    if (error) {
                        showError('ç”ŸæˆQRç å¤±è´¥');
                        console.error(error);
                    } else {
                        updateStatus('QRç å·²ç”Ÿæˆï¼Œä½¿ç”¨æ‰‹æœºæ‰«æè¿æ¥', 'success');
                    }
                }
            );
        }
        
        // é˜²æŠ–éªŒè¯å‡½æ•°
        function debouncedValidation() {
            if (validationTimeout) {
                clearTimeout(validationTimeout);
            }
            
            validationTimeout = setTimeout(() => {
                validateAndGenerateConnectionString();
            }, 500);
        }
        
        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è·å–IP
        window.addEventListener('DOMContentLoaded', () => {
            updateStatus('å·¥å…·å·²å°±ç»ª');
            
            // è®¾ç½®é»˜è®¤ç«¯å£
            serverPortInput.value = '25565';
            
            // è‡ªåŠ¨è·å–å…¬ç½‘IP
            setTimeout(() => {
                getPublicIp();
            }, 500);
            
            // ä¸ºè¾“å…¥æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬ï¼ˆä½¿ç”¨é˜²æŠ–ï¼‰
            serverIpInput.addEventListener('input', debouncedValidation);
            serverPortInput.addEventListener('input', debouncedValidation);
            
            // ä¸ºè¾“å…¥æ¡†æ·»åŠ ç¤ºä¾‹æ–‡æœ¬
            serverIpInput.placeholder = 'ä¾‹å¦‚: play.example.com æˆ– 123.45.67.89';
            
            // ä¸ºè¾“å…¥æ¡†æ·»åŠ ç„¦ç‚¹æ•ˆæœ
            serverIpInput.addEventListener('focus', function() {
                this.style.borderColor = '#3c8d2c';
                this.style.boxShadow = '0 0 0 3px rgba(60, 141, 44, 0.2)';
            });
            
            serverIpInput.addEventListener('blur', function() {
                this.style.borderColor = '#ccc';
                this.style.boxShadow = 'none';
                validateAndGenerateConnectionString(); // å¤±å»ç„¦ç‚¹æ—¶ç«‹å³éªŒè¯
            });
        });
        
        // æŒ‰é’®äº‹ä»¶ç›‘å¬
        getIpBtn.addEventListener('click', getPublicIp);
        generateBtn.addEventListener('click', validateAndGenerateConnectionString);
        copyBtn.addEventListener('click', copyConnectionString);
        shareTextBtn.addEventListener('click', generateShareText);
        shareQrBtn.addEventListener('click', generateQRCode);
        
        // æŒ‰Enteré”®ç”Ÿæˆè¿æ¥ä¿¡æ¯
        serverIpInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                validateAndGenerateConnectionString();
            }
        });
        
        serverPortInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                validateAndGenerateConnectionString();
            }
        });
    </script>
</body>
</html>
